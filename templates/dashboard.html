{% extends "base.html" %}
{% block title %}Dashboard - Job Search{% endblock %}

{% block content %}
<!-- Stats bar -->
<div class="grid grid-cols-2 sm:grid-cols-5 gap-3 mb-6">
    <div class="bg-white rounded-lg shadow-sm border p-3 text-center">
        <div class="text-2xl font-bold text-indigo-600">{{ stats.new or 0 }}</div>
        <div class="text-xs text-gray-500 uppercase tracking-wide">New</div>
    </div>
    <div class="bg-white rounded-lg shadow-sm border p-3 text-center">
        <div class="text-2xl font-bold text-gray-700">{{ stats.total or 0 }}</div>
        <div class="text-xs text-gray-500 uppercase tracking-wide">Total</div>
    </div>
    <div class="bg-white rounded-lg shadow-sm border p-3 text-center">
        <div class="text-2xl font-bold text-yellow-600">{{ stats.unranked or 0 }}</div>
        <div class="text-xs text-gray-500 uppercase tracking-wide">Unranked</div>
    </div>
    <div class="bg-white rounded-lg shadow-sm border p-3 text-center">
        <div class="text-2xl font-bold text-gray-400">{{ stats.dismissed or 0 }}</div>
        <div class="text-xs text-gray-500 uppercase tracking-wide">Dismissed</div>
    </div>
    <div class="bg-white rounded-lg shadow-sm border p-3 text-center">
        <div class="text-2xl font-bold text-green-600">{{ stats.applied or 0 }}</div>
        <div class="text-xs text-gray-500 uppercase tracking-wide">Applied</div>
    </div>
</div>

<!-- Filters -->
<div class="flex flex-wrap items-center gap-3 mb-4">
    <span class="text-sm text-gray-500">Filter:</span>
    <a href="{{ url_for('dashboard', sort=sort_by) }}"
       class="px-2.5 py-1 rounded text-sm {{ 'bg-indigo-100 text-indigo-700 font-medium' if not source_filter else 'bg-gray-100 text-gray-600 hover:bg-gray-200' }}">
        All
    </a>
    <a href="{{ url_for('dashboard', source='seek', sort=sort_by) }}"
       class="px-2.5 py-1 rounded text-sm {{ 'bg-indigo-100 text-indigo-700 font-medium' if source_filter == 'seek' else 'bg-gray-100 text-gray-600 hover:bg-gray-200' }}">
        Seek
    </a>
    <a href="{{ url_for('dashboard', source='linkedin', sort=sort_by) }}"
       class="px-2.5 py-1 rounded text-sm {{ 'bg-indigo-100 text-indigo-700 font-medium' if source_filter == 'linkedin' else 'bg-gray-100 text-gray-600 hover:bg-gray-200' }}">
        LinkedIn
    </a>

    <span class="text-gray-300">|</span>
    <span class="text-sm text-gray-500">Sort:</span>
    <a href="{{ url_for('dashboard', source=source_filter, sort='relevance') }}"
       class="px-2.5 py-1 rounded text-sm {{ 'bg-indigo-100 text-indigo-700 font-medium' if sort_by == 'relevance' else 'bg-gray-100 text-gray-600 hover:bg-gray-200' }}">
        Relevance
    </a>
    <a href="{{ url_for('dashboard', source=source_filter, sort='date') }}"
       class="px-2.5 py-1 rounded text-sm {{ 'bg-indigo-100 text-indigo-700 font-medium' if sort_by == 'date' else 'bg-gray-100 text-gray-600 hover:bg-gray-200' }}">
        Date
    </a>
    <a href="{{ url_for('dashboard', source=source_filter, sort='company') }}"
       class="px-2.5 py-1 rounded text-sm {{ 'bg-indigo-100 text-indigo-700 font-medium' if sort_by == 'company' else 'bg-gray-100 text-gray-600 hover:bg-gray-200' }}">
        Company
    </a>
</div>

<!-- Job cards -->
{% if jobs %}
<div class="text-sm text-gray-400 mb-2">Showing {{ jobs|length }}{% if has_more %} of {{ stats.new or 0 }}{% endif %} jobs</div>
<div class="space-y-3">
    {% for job in jobs %}
    <div data-job-card class="bg-white rounded-lg shadow-sm border p-4 hover:shadow-md transition-shadow">
        <div class="flex items-start justify-between gap-4">
            <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2 mb-1">
                    {% if job.relevance_score is not none %}
                    <span class="inline-flex items-center justify-center w-8 h-8 rounded-full text-sm font-bold
                        {{ 'bg-green-100 text-green-800' if job.relevance_score >= 7 else '' }}
                        {{ 'bg-yellow-100 text-yellow-800' if job.relevance_score >= 4 and job.relevance_score < 7 else '' }}
                        {{ 'bg-red-100 text-red-800' if job.relevance_score < 4 else '' }}
                    ">{{ "%.0f"|format(job.relevance_score) }}</span>
                    {% else %}
                    <span class="inline-flex items-center justify-center w-8 h-8 rounded-full text-xs bg-gray-100 text-gray-400">--</span>
                    {% endif %}

                    <h3 class="text-base font-medium text-gray-900 truncate">
                        <a href="{{ job.url }}" target="_blank" rel="noopener" class="hover:text-indigo-600">
                            {{ job.title }}
                        </a>
                    </h3>
                </div>

                <div class="flex flex-wrap items-center gap-x-3 gap-y-1 text-sm text-gray-500 mb-1.5">
                    {% if job.company %}
                    <span class="font-medium text-gray-700">{{ job.company }}</span>
                    {% endif %}
                    {% if job.location %}
                    <span>{{ job.location }}</span>
                    {% endif %}
                    {% if job.salary %}
                    <span class="text-green-700">{{ job.salary }}</span>
                    {% endif %}
                    <span class="inline-block px-1.5 py-0.5 rounded text-xs {{ 'bg-orange-50 text-orange-700' if job.source == 'seek' else 'bg-blue-50 text-blue-700' }}">
                        {{ job.source }}
                    </span>
                </div>

                {% if job.relevance_explanation %}
                <p class="text-sm text-gray-500 italic">{{ job.relevance_explanation }}</p>
                {% endif %}

                {% if job.description %}
                <p class="text-sm text-gray-400 mt-1 line-clamp-2">{{ job.description }}</p>
                {% endif %}
            </div>

            <div class="flex flex-col gap-1.5 flex-shrink-0">
                <a href="{{ job.url }}" target="_blank" rel="noopener"
                   class="px-2.5 py-1 text-xs font-medium rounded bg-indigo-50 text-indigo-700 hover:bg-indigo-100 text-center">
                    Open
                </a>
                <button onclick="jobAction('/jobs/{{ job.id }}/seen', this)"
                        class="px-2.5 py-1 text-xs font-medium rounded bg-gray-50 text-gray-600 hover:bg-gray-100">
                    Seen
                </button>
                <button onclick="jobAction('/jobs/{{ job.id }}/dismiss', this)"
                        class="px-2.5 py-1 text-xs font-medium rounded bg-gray-50 text-gray-600 hover:bg-red-50 hover:text-red-600">
                    Dismiss
                </button>
                <button onclick="jobAction('/jobs/{{ job.id }}/applied', this)"
                        class="px-2.5 py-1 text-xs font-medium rounded bg-green-50 text-green-700 hover:bg-green-100">
                    Applied
                </button>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% if has_more %}
<div class="text-center mt-6">
    <a href="{{ url_for('dashboard', source=source_filter, sort=sort_by, limit=limit + 25) }}"
       class="inline-block px-6 py-2 text-sm font-medium rounded-lg bg-indigo-50 text-indigo-700 hover:bg-indigo-100 transition-colors">
        Show More
    </a>
</div>
{% endif %}
{% else %}
<div class="text-center py-16 text-gray-400">
    <p class="text-lg mb-2">No new jobs to review</p>
    <p class="text-sm">Click "Fetch New Jobs" to scrape the latest listings, or check <a href="{{ url_for('all_jobs') }}" class="text-indigo-500 hover:underline">All Jobs</a>.</p>
</div>
{% endif %}
{% endblock %}
