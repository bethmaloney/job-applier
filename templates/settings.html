{% extends "base.html" %}
{% block title %}Settings - Job Search{% endblock %}

{% block content %}
<div class="max-w-3xl">
    <h1 class="text-xl font-semibold text-gray-900 mb-6">Settings</h1>

    <!-- Profile form -->
    <form method="POST" class="bg-white rounded-lg shadow-sm border p-6 mb-8">
        <h2 class="text-lg font-medium text-gray-800 mb-4">Your Profile</h2>
        <p class="text-sm text-gray-500 mb-4">This information is sent to Claude to rank job relevance.</p>

        <div class="space-y-4">
            <div>
                <label for="location" class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                <input type="text" id="location" name="location"
                       value="{{ profile.location if profile else '' }}"
                       placeholder="e.g. Melbourne, Australia (targeting Melbourne + Remote Australia roles)"
                       class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm px-3 py-2 border">
            </div>

            <div>
                <label for="target_titles" class="block text-sm font-medium text-gray-700 mb-1">Target Job Titles</label>
                <input type="text" id="target_titles" name="target_titles"
                       value="{{ profile.target_titles if profile else '' }}"
                       placeholder="e.g. Software Engineer, Backend Developer, Python Developer"
                       class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm px-3 py-2 border">
            </div>

            <div>
                <label for="skills" class="block text-sm font-medium text-gray-700 mb-1">Skills</label>
                <textarea id="skills" name="skills" rows="3"
                          placeholder="e.g. Python, JavaScript, React, AWS, PostgreSQL, Docker..."
                          class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm px-3 py-2 border">{{ profile.skills if profile else '' }}</textarea>
            </div>

            <div>
                <label for="preferences" class="block text-sm font-medium text-gray-700 mb-1">Preferences</label>
                <textarea id="preferences" name="preferences" rows="2"
                          placeholder="e.g. Remote-friendly, startup culture, no finance/gambling, prefer product companies"
                          class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm px-3 py-2 border">{{ profile.preferences if profile else '' }}</textarea>
            </div>

            <div>
                <label for="min_salary" class="block text-sm font-medium text-gray-700 mb-1">Minimum Salary (AUD)</label>
                <input type="number" id="min_salary" name="min_salary"
                       value="{{ profile.min_salary if profile and profile.min_salary else '' }}"
                       placeholder="e.g. 120000"
                       class="w-48 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm px-3 py-2 border">
            </div>

            <div>
                <label for="cover_letter_instructions" class="block text-sm font-medium text-gray-700 mb-1">Cover Letter Instructions</label>
                <textarea id="cover_letter_instructions" name="cover_letter_instructions" rows="3"
                          placeholder="e.g. Professional, confident, accomplishment-focused. Emphasize measurable outcomes and technical leadership."
                          class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm px-3 py-2 border">{{ profile.cover_letter_instructions if profile and profile.cover_letter_instructions else '' }}</textarea>
                <p class="mt-1 text-xs text-gray-400">Tone and style guidance passed to Claude when generating cover letters. Leave blank for the default.</p>
            </div>

            <div>
                <label for="resume_text" class="block text-sm font-medium text-gray-700 mb-1">Resume / Experience Summary</label>
                <textarea id="resume_text" name="resume_text" rows="6"
                          placeholder="Paste a summary of your experience, or your full resume text..."
                          class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm px-3 py-2 border font-mono">{{ profile.resume_text if profile else '' }}</textarea>
            </div>
        </div>

        <div class="mt-5">
            <button type="submit"
                    class="px-4 py-2 text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                Save Profile
            </button>
        </div>
    </form>

    <!-- Job searches -->
    <div class="bg-white rounded-lg shadow-sm border p-6 mb-8">
        <h2 class="text-lg font-medium text-gray-800 mb-4">Job Searches</h2>
        <p class="text-sm text-gray-500 mb-4">Configure which searches to run when fetching jobs.</p>

        {% if search_configs %}
        <div class="overflow-x-auto mb-4">
            <table class="min-w-full divide-y divide-gray-200 text-sm">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Source</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Keywords</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Location</th>
                        <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    {% for sc in search_configs %}
                    <tr>
                        <td class="px-3 py-2">
                            <span class="px-1.5 py-0.5 rounded text-xs {{ 'bg-orange-50 text-orange-700' if sc.source == 'seek' else 'bg-blue-50 text-blue-700' }}">
                                {{ sc.source }}
                            </span>
                        </td>
                        <td class="px-3 py-2 text-gray-700">{{ sc.keywords }}</td>
                        <td class="px-3 py-2 text-gray-700">{{ sc.location }}</td>
                        <td class="px-3 py-2 text-right">
                            <form method="POST" action="{{ url_for('delete_search', config_id=sc.id) }}" class="inline">
                                <button type="submit" class="text-red-500 hover:text-red-700 text-xs font-medium"
                                        onclick="return confirm('Remove this search?')">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-sm text-gray-400 mb-4">No searches configured.</p>
        {% endif %}

        <form method="POST" action="{{ url_for('add_search') }}" class="flex flex-wrap items-end gap-3 pt-3 border-t">
            <div>
                <label for="source" class="block text-xs font-medium text-gray-600 mb-1">Source</label>
                <select id="source" name="source"
                        class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm px-3 py-2 border">
                    <option value="seek">Seek</option>
                    <option value="linkedin">LinkedIn</option>
                </select>
            </div>
            <div class="flex-1 min-w-[150px]">
                <label for="keywords" class="block text-xs font-medium text-gray-600 mb-1">Keywords</label>
                <input type="text" id="keywords" name="keywords" required placeholder="e.g. software engineer"
                       class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm px-3 py-2 border">
            </div>
            <div class="flex-1 min-w-[150px]">
                <label for="search_location" class="block text-xs font-medium text-gray-600 mb-1">Location</label>
                <input type="text" id="search_location" name="location" required placeholder="e.g. Melbourne VIC"
                       class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm px-3 py-2 border">
            </div>
            <button type="submit"
                    class="px-4 py-2 text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                Add Search
            </button>
        </form>
    </div>

    <!-- Fetch logs -->
    <div class="bg-white rounded-lg shadow-sm border p-6">
        <h2 class="text-lg font-medium text-gray-800 mb-4">Fetch History</h2>
        {% if logs %}
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 text-sm">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Time</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Source</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Found</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">New</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Errors</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    {% for log in logs %}
                    <tr>
                        <td class="px-3 py-2 text-gray-600 whitespace-nowrap">{{ log.timestamp }}</td>
                        <td class="px-3 py-2">
                            <span class="px-1.5 py-0.5 rounded text-xs {{ 'bg-orange-50 text-orange-700' if log.source == 'seek' else 'bg-blue-50 text-blue-700' }}">
                                {{ log.source }}
                            </span>
                        </td>
                        <td class="px-3 py-2 text-gray-600">{{ log.jobs_found }}</td>
                        <td class="px-3 py-2 text-gray-600">{{ log.new_jobs }}</td>
                        <td class="px-3 py-2 text-red-500 text-xs">{{ log.errors or '-' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-sm text-gray-400">No fetches yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
