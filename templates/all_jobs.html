{% extends "base.html" %}
{% block title %}All Jobs - Job Search{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-4">
    <h1 class="text-xl font-semibold text-gray-900">All Jobs ({{ total }})</h1>
    <div class="flex items-center gap-2">
        <a href="{{ url_for('all_jobs', page=page, dismissed='1' if not show_dismissed else '0') }}"
           class="text-sm px-3 py-1.5 rounded {{ 'bg-indigo-100 text-indigo-700' if show_dismissed else 'bg-gray-100 text-gray-600 hover:bg-gray-200' }}">
            {{ 'Hide' if show_dismissed else 'Show' }} dismissed
        </a>
    </div>
</div>

{% if jobs %}
<div class="bg-white rounded-lg shadow-sm border overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-4 py-2.5 text-left text-xs font-medium text-gray-500 uppercase">Score</th>
                <th class="px-4 py-2.5 text-left text-xs font-medium text-gray-500 uppercase">Title</th>
                <th class="px-4 py-2.5 text-left text-xs font-medium text-gray-500 uppercase hidden sm:table-cell">Company</th>
                <th class="px-4 py-2.5 text-left text-xs font-medium text-gray-500 uppercase hidden md:table-cell">Location</th>
                <th class="px-4 py-2.5 text-left text-xs font-medium text-gray-500 uppercase">Source</th>
                <th class="px-4 py-2.5 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                <th class="px-4 py-2.5 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
            {% for job in jobs %}
            <tr class="{{ 'opacity-50' if job.dismissed else '' }} hover:bg-gray-50" data-job-card>
                <td class="px-4 py-2.5 text-sm">
                    {% if job.relevance_score is not none %}
                    <span class="inline-flex items-center justify-center w-7 h-7 rounded-full text-xs font-bold
                        {{ 'bg-green-100 text-green-800' if job.relevance_score >= 7 else '' }}
                        {{ 'bg-yellow-100 text-yellow-800' if job.relevance_score >= 4 and job.relevance_score < 7 else '' }}
                        {{ 'bg-red-100 text-red-800' if job.relevance_score < 4 else '' }}
                    ">{{ "%.0f"|format(job.relevance_score) }}</span>
                    {% else %}
                    <span class="text-gray-300">--</span>
                    {% endif %}
                </td>
                <td class="px-4 py-2.5 text-sm">
                    <a href="{{ job.url }}" target="_blank" rel="noopener" class="text-gray-900 hover:text-indigo-600 font-medium">
                        {{ job.title|truncate(50) }}
                    </a>
                </td>
                <td class="px-4 py-2.5 text-sm text-gray-500 hidden sm:table-cell">{{ job.company|truncate(25) if job.company else '-' }}</td>
                <td class="px-4 py-2.5 text-sm text-gray-500 hidden md:table-cell">{{ job.location|truncate(25) if job.location else '-' }}</td>
                <td class="px-4 py-2.5 text-sm">
                    <span class="px-1.5 py-0.5 rounded text-xs {{ 'bg-orange-50 text-orange-700' if job.source == 'seek' else 'bg-blue-50 text-blue-700' }}">
                        {{ job.source }}
                    </span>
                </td>
                <td class="px-4 py-2.5 text-sm">
                    {% if job.applied %}
                    <span class="px-1.5 py-0.5 rounded text-xs bg-green-100 text-green-700">Applied</span>
                    {% elif job.dismissed %}
                    <span class="px-1.5 py-0.5 rounded text-xs bg-red-50 text-red-500">Dismissed</span>
                    {% elif job.seen %}
                    <span class="px-1.5 py-0.5 rounded text-xs bg-gray-100 text-gray-500">Seen</span>
                    {% else %}
                    <span class="px-1.5 py-0.5 rounded text-xs bg-indigo-50 text-indigo-600">New</span>
                    {% endif %}
                </td>
                <td class="px-4 py-2.5 text-sm">
                    <div class="flex gap-1">
                        {% if not job.dismissed %}
                        <button onclick="jobAction('/jobs/{{ job.id }}/dismiss', this)"
                                class="px-2 py-0.5 text-xs rounded bg-gray-50 text-gray-500 hover:bg-red-50 hover:text-red-600">
                            Dismiss
                        </button>
                        {% endif %}
                        {% if not job.applied %}
                        <button onclick="jobAction('/jobs/{{ job.id }}/applied', this)"
                                class="px-2 py-0.5 text-xs rounded bg-green-50 text-green-600 hover:bg-green-100">
                            Applied
                        </button>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if total_pages > 1 %}
<div class="flex items-center justify-center gap-2 mt-4">
    {% if page > 1 %}
    <a href="{{ url_for('all_jobs', page=page - 1, dismissed='1' if show_dismissed else '0') }}"
       class="px-3 py-1.5 text-sm rounded bg-gray-100 text-gray-600 hover:bg-gray-200">&larr; Prev</a>
    {% endif %}
    <span class="text-sm text-gray-500">Page {{ page }} of {{ total_pages }}</span>
    {% if page < total_pages %}
    <a href="{{ url_for('all_jobs', page=page + 1, dismissed='1' if show_dismissed else '0') }}"
       class="px-3 py-1.5 text-sm rounded bg-gray-100 text-gray-600 hover:bg-gray-200">Next &rarr;</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="text-center py-16 text-gray-400">
    <p class="text-lg">No jobs yet. Click "Fetch New Jobs" to get started.</p>
</div>
{% endif %}
{% endblock %}
